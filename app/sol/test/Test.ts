import { EthereumVirtualMachine } from "../../class/ethereumVirtualMachine/EthereumVirtualMachine.ts";
import { ethers as Ethers } from "ethers";
import { secret } from "../../class/host/Secret.ts";
import { File } from "../../class/host/file/File.ts";
import { Path } from "../../class/host/Path.ts";
import * as TsResult from "ts-results";




(async function() {
    let mainnetNodeUrl = "https://polygon-rpc.com";
    let testnetNodeUrl =  "https://rpc.tenderly.co/fork/ca9185f3-d050-4189-90b5-53d35e920601";
    let nodeUrl = testnetNodeUrl;
    let key = secret("polygonPrivateKey");
    if (key.none) {
        err("MISSING_PRIVATE_KEY");
        return;
    }
    let node = new Ethers.JsonRpcProvider(nodeUrl);
    let signer = new Ethers.Wallet(key.unwrap(), node);
    let machine = EthereumVirtualMachine(signer);

    await (async function() {
        let factory = "0x5757371414417b8C6CAad45bAeF941aBc7d3Ab32";
        let router = "0xa5E0829CaCEd8fFDD4De3c43696c57F7D7A678ff";
        let usdc = "0x3c499c542cEF5E3811e1192ce70d8cC03d5c3359";
        let weth = "0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619";
        let wbtc = "0x1BFD67037B42Cf73acF2047067bd4F2C47D9BfD6";
        let link = "0x53E0bca35eC356BD5ddDFebbD1Fc0fD03FaBad39";
        let wmatic = "0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270";
        let adaptor = ((await (machine.deploy({ bytecode: "6080604052348015600e575f80fd5b5061326b8061001c5f395ff3fe608060405234801561000f575f80fd5b506004361061004a575f3560e01c80631dac821f1461004e5780634b08f1251461007e5780634fb76f3d146100ae5780639ef8b9ec146100de575b5f80fd5b61006860048036038101906100639190612104565b61010e565b60405161007591906121a6565b60405180910390f35b61009860048036038101906100939190612234565b610395565b6040516100a59190612341565b60405180910390f35b6100c860048036038101906100c391906123f8565b610ab7565b6040516100d59190612432565b60405180910390f35b6100f860048036038101906100f3919061244b565b61107f565b604051610105919061257d565b60405180910390f35b610116611cbe565b5f73ffffffffffffffffffffffffffffffffffffffff16836060015173ffffffffffffffffffffffffffffffffffffffff161415801561018657505f73ffffffffffffffffffffffffffffffffffffffff16836080015173ffffffffffffffffffffffffffffffffffffffff1614155b801561019957505f8360a0015160ff1614155b80156101ac57505f8360c0015160ff1614155b80156101e857505f73ffffffffffffffffffffffffffffffffffffffff16836020015173ffffffffffffffffffffffffffffffffffffffff1614155b801561022457505f73ffffffffffffffffffffffffffffffffffffffff16836040015173ffffffffffffffffffffffffffffffffffffffff1614155b610263576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161025a906125f1565b60405180910390fd5b5f8360e001516dffffffffffffffffffffffffffff161415801561029c57505f8361010001516dffffffffffffffffffffffffffff1614155b6102db576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102d290612659565b60405180910390fd5b6102e3611cbe565b82815f018181525050610325838560e001516dffffffffffffffffffffffffffff168661010001516dffffffffffffffffffffffffffff168760400151611415565b816020018181525050610367838560e001516dffffffffffffffffffffffffffff168661010001516dffffffffffffffffffffffffffff1687604001516114c2565b8160400181815250506103828160400151826020015161156f565b8160600181815250508091505092915050565b61039d611ce2565b5f73ffffffffffffffffffffffffffffffffffffffff16825f015173ffffffffffffffffffffffffffffffffffffffff161415801561040c57505f73ffffffffffffffffffffffffffffffffffffffff16826020015173ffffffffffffffffffffffffffffffffffffffff1614155b801561044857505f73ffffffffffffffffffffffffffffffffffffffff16826040015173ffffffffffffffffffffffffffffffffffffffff1614155b801561048457505f73ffffffffffffffffffffffffffffffffffffffff16826060015173ffffffffffffffffffffffffffffffffffffffff1614155b6104c3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104ba906126c1565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff16825f015173ffffffffffffffffffffffffffffffffffffffff1663e6a43905846040015185606001516040518363ffffffff1660e01b81526004016105209291906126ee565b602060405180830381865afa15801561053b573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061055f9190612729565b73ffffffffffffffffffffffffffffffffffffffff16036105b5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105ac9061279e565b60405180910390fd5b6105bd611ce2565b825f0151816020019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250508260200151816040019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250508260400151816060019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250508260600151816080019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff1681525050806060015173ffffffffffffffffffffffffffffffffffffffff1663313ce5676040518163ffffffff1660e01b8152600401602060405180830381865afa1580156106f9573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061071d91906127d0565b8160a0019060ff16908160ff1681525050806080015173ffffffffffffffffffffffffffffffffffffffff1663313ce5676040518163ffffffff1660e01b8152600401602060405180830381865afa15801561077b573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061079f91906127d0565b8160c0019060ff16908160ff16815250505f816020015173ffffffffffffffffffffffffffffffffffffffff1663e6a43905836060015184608001516040518363ffffffff1660e01b81526004016107f89291906126ee565b602060405180830381865afa158015610813573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906108379190612729565b905080825f019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250505f8190505f808273ffffffffffffffffffffffffffffffffffffffff16630902f1ac6040518163ffffffff1660e01b8152600401606060405180830381865afa1580156108bf573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906108e39190612848565b50915091505f8373ffffffffffffffffffffffffffffffffffffffff16630dfe16816040518163ffffffff1660e01b8152600401602060405180830381865afa158015610932573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906109569190612729565b90508073ffffffffffffffffffffffffffffffffffffffff16866060015173ffffffffffffffffffffffffffffffffffffffff16146109b4576109af826dffffffffffffffffffffffffffff168760a0015160126115f8565b6109d5565b6109d4836dffffffffffffffffffffffffffff168760a0015160126115f8565b5b8660e001906dffffffffffffffffffffffffffff1690816dffffffffffffffffffffffffffff16815250508073ffffffffffffffffffffffffffffffffffffffff16866060015173ffffffffffffffffffffffffffffffffffffffff1614610a5c57610a57836dffffffffffffffffffffffffffff168760c0015160126115f8565b610a7d565b610a7c826dffffffffffffffffffffffffffff168760c0015160126115f8565b5b8661010001906dffffffffffffffffffffffffffff1690816dffffffffffffffffffffffffffff1681525050859650505050505050919050565b5f816040015182608001518360200151610ad28383836116ba565b505f73ffffffffffffffffffffffffffffffffffffffff16855f015173ffffffffffffffffffffffffffffffffffffffff1614158015610b4257505f73ffffffffffffffffffffffffffffffffffffffff16856020015173ffffffffffffffffffffffffffffffffffffffff1614155b8015610b7e57505f73ffffffffffffffffffffffffffffffffffffffff16856040015173ffffffffffffffffffffffffffffffffffffffff1614155b8015610bba57505f73ffffffffffffffffffffffffffffffffffffffff16856060015173ffffffffffffffffffffffffffffffffffffffff1614155b8015610bca57505f856080015114155b610c09576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c00906128e2565b60405180910390fd5b610c11611db9565b8560400151816040019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250508560600151816060019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff1681525050855f0151815f019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250508560200151816020019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250505f610d16610d0c83610395565b886080015161010e565b90505f815f015114158015610d2f57505f816020015114155b8015610d3f57505f816040015114155b8015610d4f57505f816060015114155b610d8e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d859061294a565b60405180910390fd5b8660a0015181606001511115610dd9576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610dd0906129d8565b60405180910390fd5b5f600267ffffffffffffffff811115610df557610df4611ea9565b5b604051908082528060200260200182016040528015610e235781602001602082028036833780820191505090505b5090508760400151815f81518110610e3e57610e3d6129f6565b5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff1681525050876060015181600181518110610e9157610e906129f6565b5b602002602001019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250505f886040015173ffffffffffffffffffffffffffffffffffffffff1663313ce5676040518163ffffffff1660e01b8152600401602060405180830381865afa158015610f19573d5f803e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610f3d91906127d0565b90505f610f508a608001516012846115f8565b90505f8a6020015173ffffffffffffffffffffffffffffffffffffffff166338ed1739835f8733426040518663ffffffff1660e01b8152600401610f98959493929190612b0d565b5f604051808303815f875af1158015610fb3573d5f803e3d5ffd5b505050506040513d5f823e3d601f19601f82011682018060405250810190610fdb9190612c41565b90505f8160018351610fed9190612cb5565b81518110610ffe57610ffd6129f6565b5b602002602001015190505f611015828660126115f8565b90507f6c2b29894dc4c2af570f8fce5de753d9dfce4efc8b7b3a68aeb12e8be8ecd7768d604001518e606001518f60800151846040516110589493929190612ce8565b60405180910390a1809b5050505050505050506110768383836119f3565b50505050919050565b611087611e35565b61108f611e35565b83816020018181525050828161014001818152505061119b856060015173ffffffffffffffffffffffffffffffffffffffff166370a08231336040518263ffffffff1660e01b81526004016110e49190612d2b565b602060405180830381865afa1580156110ff573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906111239190612d44565b866060015173ffffffffffffffffffffffffffffffffffffffff1663313ce5676040518163ffffffff1660e01b8152600401602060405180830381865afa158015611170573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061119491906127d0565b60126115f8565b8160400181815250505f6111b386836040015161010e565b905080602001518260800181815250506111e86111d98360800151846101400151611a93565b68056bc75e2d63100000611aaf565b825f01818152505061121561120b83610140015168056bc75e2d63100000611a93565b8360200151611aaf565b8260a0018181525050611226611db9565b8660200151815f019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250508660400151816020019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250508660800151816040019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250508660600151816060019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250505f61131f82610395565b90505f611330828660a0015161010e565b905080602001518560600181815250508460600151856040015111611355575f611368565b61136785604001518660600151611acb565b5b8560c00181815250508460600151856040015110611386575f611399565b61139885606001518660400151611acb565b5b8560e00181815250508460a001518560800151116113b7575f6113ca565b6113c985608001518660a00151611acb565b5b856101000181815250508460a001518560800151106113e9575f6113fc565b6113fb8560a001518660800151611acb565b5b8561012001818152505084955050505050509392505050565b5f8085146114b6575f84148061142a57505f83145b6114af578173ffffffffffffffffffffffffffffffffffffffff1663ad615dec8686866040518463ffffffff1660e01b815260040161146b93929190612d6f565b602060405180830381865afa158015611486573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906114aa9190612d44565b6114b1565b5f5b6114b8565b5f5b9050949350505050565b5f808514611563575f8414806114d757505f83145b61155c578173ffffffffffffffffffffffffffffffffffffffff1663054d50d48686866040518463ffffffff1660e01b815260040161151893929190612d6f565b602060405180830381865afa158015611533573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906115579190612d44565b61155e565b5f5b611565565b5f5b9050949350505050565b5f808314801561157f57505f8214155b6115ee575f831415801561159257505f82145b6115de575f831480156115a457505f82145b6115ce578183116115be576115b98383611b1a565b6115c9565b68056bc75e2d631000005b6115d9565b68056bc75e2d631000005b6115e9565b68056bc75e2d631000005b6115f0565b5f5b905092915050565b5f60028360ff1610158015611611575060028260ff1610155b8015611621575060128360ff1611155b8015611631575060128260ff1611155b611670576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161166790612dee565b60405180910390fd5b5f84148061168357508160ff168360ff16145b6116af576116aa8483600a6116989190612f3b565b85600a6116a59190612f3b565b611b3f565b6116b1565b835b90509392505050565b5f805f9054906101000a900460ff1615611709576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161170090612fcf565b60405180910390fd5b60015f806101000a81548160ff0219169083151502179055505f8473ffffffffffffffffffffffffffffffffffffffff1663313ce5676040518163ffffffff1660e01b8152600401602060405180830381865afa15801561176c573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061179091906127d0565b90505f8573ffffffffffffffffffffffffffffffffffffffff166370a08231336040518263ffffffff1660e01b81526004016117cc9190612d2b565b602060405180830381865afa1580156117e7573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061180b9190612d44565b90505f61181a828460126115f8565b90508086111561185f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161185690613037565b60405180910390fd5b5f61186c876012866115f8565b90508773ffffffffffffffffffffffffffffffffffffffff166323b872dd3330846040518463ffffffff1660e01b81526004016118ab93929190613055565b6020604051808303815f875af11580156118c7573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906118eb91906130bf565b508773ffffffffffffffffffffffffffffffffffffffff1663095ea7b3875f6040518363ffffffff1660e01b81526004016119279291906130ea565b6020604051808303815f875af1158015611943573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061196791906130bf565b508773ffffffffffffffffffffffffffffffffffffffff1663095ea7b387836040518363ffffffff1660e01b81526004016119a3929190613111565b6020604051808303815f875af11580156119bf573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906119e391906130bf565b5060019450505050509392505050565b5f8373ffffffffffffffffffffffffffffffffffffffff1663095ea7b3835f6040518363ffffffff1660e01b8152600401611a2f9291906130ea565b6020604051808303815f875af1158015611a4b573d5f803e3d5ffd5b505050506040513d601f19601f82011682018060405250810190611a6f91906130bf565b505f805f6101000a81548160ff021916908315150217905550600190509392505050565b5f611aa783670de0b6b3a764000084611b3f565b905092915050565b5f611ac38383670de0b6b3a7640000611b3f565b905092915050565b5f82821115611b0f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611b0690613182565b60405180910390fd5b818303905092915050565b5f611b3768056bc75e2d63100000611b328585611b54565b611acb565b905092915050565b5f611b4b848484611b8f565b90509392505050565b5f808303611b64575f9050611b89565b81831015611b7b57611b768383611c99565b611b86565b68056bc75e2d631000005b90505b92915050565b5f805f80198587098587029250828110838203039150505f8103611bc757838281611bbd57611bbc6131a0565b5b0492505050611c92565b808411611c09576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611c0090613217565b60405180910390fd5b5f8486880990508281118203915080830392505f60018619018616905080860495508084049350600181825f0304019050808302841793505f600287600302189050808702600203810290508087026002038102905080870260020381029050808702600203810290508087026002038102905080870260020381029050808502955050505050505b9392505050565b5f611cb6611ca78484611a93565b68056bc75e2d63100000611aaf565b905092915050565b60405180608001604052805f81526020015f81526020015f81526020015f81525090565b6040518061012001604052805f73ffffffffffffffffffffffffffffffffffffffff1681526020015f73ffffffffffffffffffffffffffffffffffffffff1681526020015f73ffffffffffffffffffffffffffffffffffffffff1681526020015f73ffffffffffffffffffffffffffffffffffffffff1681526020015f73ffffffffffffffffffffffffffffffffffffffff1681526020015f60ff1681526020015f60ff1681526020015f6dffffffffffffffffffffffffffff1681526020015f6dffffffffffffffffffffffffffff1681525090565b60405180608001604052805f73ffffffffffffffffffffffffffffffffffffffff1681526020015f73ffffffffffffffffffffffffffffffffffffffff1681526020015f73ffffffffffffffffffffffffffffffffffffffff1681526020015f73ffffffffffffffffffffffffffffffffffffffff1681525090565b6040518061016001604052805f81526020015f81526020015f81526020015f81526020015f81526020015f81526020015f81526020015f81526020015f81526020015f81526020015f81525090565b5f604051905090565b5f80fd5b5f80fd5b5f80fd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b611edf82611e99565b810181811067ffffffffffffffff82111715611efe57611efd611ea9565b5b80604052505050565b5f611f10611e84565b9050611f1c8282611ed6565b919050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f611f4a82611f21565b9050919050565b611f5a81611f40565b8114611f64575f80fd5b50565b5f81359050611f7581611f51565b92915050565b5f60ff82169050919050565b611f9081611f7b565b8114611f9a575f80fd5b50565b5f81359050611fab81611f87565b92915050565b5f6dffffffffffffffffffffffffffff82169050919050565b611fd381611fb1565b8114611fdd575f80fd5b50565b5f81359050611fee81611fca565b92915050565b5f610120828403121561200a57612009611e95565b5b612015610120611f07565b90505f61202484828501611f67565b5f83015250602061203784828501611f67565b602083015250604061204b84828501611f67565b604083015250606061205f84828501611f67565b606083015250608061207384828501611f67565b60808301525060a061208784828501611f9d565b60a08301525060c061209b84828501611f9d565b60c08301525060e06120af84828501611fe0565b60e0830152506101006120c484828501611fe0565b6101008301525092915050565b5f819050919050565b6120e3816120d1565b81146120ed575f80fd5b50565b5f813590506120fe816120da565b92915050565b5f80610140838503121561211b5761211a611e8d565b5b5f61212885828601611ff4565b92505061012061213a858286016120f0565b9150509250929050565b61214d816120d1565b82525050565b608082015f8201516121675f850182612144565b50602082015161217a6020850182612144565b50604082015161218d6040850182612144565b5060608201516121a06060850182612144565b50505050565b5f6080820190506121b95f830184612153565b92915050565b5f608082840312156121d4576121d3611e95565b5b6121de6080611f07565b90505f6121ed84828501611f67565b5f83015250602061220084828501611f67565b602083015250604061221484828501611f67565b604083015250606061222884828501611f67565b60608301525092915050565b5f6080828403121561224957612248611e8d565b5b5f612256848285016121bf565b91505092915050565b61226881611f40565b82525050565b61227781611f7b565b82525050565b61228681611fb1565b82525050565b61012082015f8201516122a15f85018261225f565b5060208201516122b4602085018261225f565b5060408201516122c7604085018261225f565b5060608201516122da606085018261225f565b5060808201516122ed608085018261225f565b5060a082015161230060a085018261226e565b5060c082015161231360c085018261226e565b5060e082015161232660e085018261227d565b5061010082015161233b61010085018261227d565b50505050565b5f610120820190506123555f83018461228c565b92915050565b5f60c082840312156123705761236f611e95565b5b61237a60c0611f07565b90505f61238984828501611f67565b5f83015250602061239c84828501611f67565b60208301525060406123b084828501611f67565b60408301525060606123c484828501611f67565b60608301525060806123d8848285016120f0565b60808301525060a06123ec848285016120f0565b60a08301525092915050565b5f60c0828403121561240d5761240c611e8d565b5b5f61241a8482850161235b565b91505092915050565b61242c816120d1565b82525050565b5f6020820190506124455f830184612423565b92915050565b5f805f610160848603121561246357612462611e8d565b5b5f61247086828701611ff4565b935050610120612482868287016120f0565b925050610140612494868287016120f0565b9150509250925092565b61016082015f8201516124b35f850182612144565b5060208201516124c66020850182612144565b5060408201516124d96040850182612144565b5060608201516124ec6060850182612144565b5060808201516124ff6080850182612144565b5060a082015161251260a0850182612144565b5060c082015161252560c0850182612144565b5060e082015161253860e0850182612144565b5061010082015161254d610100850182612144565b50610120820151612562610120850182612144565b50610140820151612577610140850182612144565b50505050565b5f610160820190506125915f83018461249e565b92915050565b5f82825260208201905092915050565b7f564f49445f5041495200000000000000000000000000000000000000000000005f82015250565b5f6125db600983612597565b91506125e6826125a7565b602082019050919050565b5f6020820190508181035f830152612608816125cf565b9050919050565b7f494e53554646494349454e545f4c4951554944495459000000000000000000005f82015250565b5f612643601683612597565b915061264e8261260f565b602082019050919050565b5f6020820190508181035f83015261267081612637565b9050919050565b7f564f49445f4153534554000000000000000000000000000000000000000000005f82015250565b5f6126ab600a83612597565b91506126b682612677565b602082019050919050565b5f6020820190508181035f8301526126d88161269f565b9050919050565b6126e881611f40565b82525050565b5f6040820190506127015f8301856126df565b61270e60208301846126df565b9392505050565b5f8151905061272381611f51565b92915050565b5f6020828403121561273e5761273d611e8d565b5b5f61274b84828501612715565b91505092915050565b7f504149525f4e4f545f464f554e440000000000000000000000000000000000005f82015250565b5f612788600e83612597565b915061279382612754565b602082019050919050565b5f6020820190508181035f8301526127b58161277c565b9050919050565b5f815190506127ca81611f87565b92915050565b5f602082840312156127e5576127e4611e8d565b5b5f6127f2848285016127bc565b91505092915050565b5f8151905061280981611fca565b92915050565b5f63ffffffff82169050919050565b6128278161280f565b8114612831575f80fd5b50565b5f815190506128428161281e565b92915050565b5f805f6060848603121561285f5761285e611e8d565b5b5f61286c868287016127fb565b935050602061287d868287016127fb565b925050604061288e86828701612834565b9150509250925092565b7f556e6973776170456e67696e653a20564f49445f535741505f524551554553545f82015250565b5f6128cc602083612597565b91506128d782612898565b602082019050919050565b5f6020820190508181035f8301526128f9816128c0565b9050919050565b7f556e6973776170456e67696e653a20564f49445f51554f54455f524553554c545f82015250565b5f612934602083612597565b915061293f82612900565b602082019050919050565b5f6020820190508181035f83015261296181612928565b9050919050565b7f556e6973776170456e67696e653a20534c4950504147455f455843454544535f5f8201527f5448524553484f4c440000000000000000000000000000000000000000000000602082015250565b5f6129c2602983612597565b91506129cd82612968565b604082019050919050565b5f6020820190508181035f8301526129ef816129b6565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b5f819050919050565b5f819050919050565b5f612a4f612a4a612a4584612a23565b612a2c565b6120d1565b9050919050565b612a5f81612a35565b82525050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b5f612a99838361225f565b60208301905092915050565b5f602082019050919050565b5f612abb82612a65565b612ac58185612a6f565b9350612ad083612a7f565b805f5b83811015612b00578151612ae78882612a8e565b9750612af283612aa5565b925050600181019050612ad3565b5085935050505092915050565b5f60a082019050612b205f830188612423565b612b2d6020830187612a56565b8181036040830152612b3f8186612ab1565b9050612b4e60608301856126df565b612b5b6080830184612423565b9695505050505050565b5f80fd5b5f67ffffffffffffffff821115612b8357612b82611ea9565b5b602082029050602081019050919050565b5f80fd5b5f81519050612ba6816120da565b92915050565b5f612bbe612bb984612b69565b611f07565b90508083825260208201905060208402830185811115612be157612be0612b94565b5b835b81811015612c0a5780612bf68882612b98565b845260208401935050602081019050612be3565b5050509392505050565b5f82601f830112612c2857612c27612b65565b5b8151612c38848260208601612bac565b91505092915050565b5f60208284031215612c5657612c55611e8d565b5b5f82015167ffffffffffffffff811115612c7357612c72611e91565b5b612c7f84828501612c14565b91505092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f612cbf826120d1565b9150612cca836120d1565b9250828203905081811115612ce257612ce1612c88565b5b92915050565b5f608082019050612cfb5f8301876126df565b612d0860208301866126df565b612d156040830185612423565b612d226060830184612423565b95945050505050565b5f602082019050612d3e5f8301846126df565b92915050565b5f60208284031215612d5957612d58611e8d565b5b5f612d6684828501612b98565b91505092915050565b5f606082019050612d825f830186612423565b612d8f6020830185612423565b612d9c6040830184612423565b949350505050565b7f444543494d414c535f4f55545f4f465f424f554e4453000000000000000000005f82015250565b5f612dd8601683612597565b9150612de382612da4565b602082019050919050565b5f6020820190508181035f830152612e0581612dcc565b9050919050565b5f8160011c9050919050565b5f808291508390505b6001851115612e6157808604811115612e3d57612e3c612c88565b5b6001851615612e4c5780820291505b8081029050612e5a85612e0c565b9450612e21565b94509492505050565b5f82612e795760019050612f34565b81612e86575f9050612f34565b8160018114612e9c5760028114612ea657612ed5565b6001915050612f34565b60ff841115612eb857612eb7612c88565b5b8360020a915084821115612ecf57612ece612c88565b5b50612f34565b5060208310610133831016604e8410600b8410161715612f0a5782820a905083811115612f0557612f04612c88565b5b612f34565b612f178484846001612e18565b92509050818404811115612f2e57612f2d612c88565b5b81810290505b9392505050565b5f612f45826120d1565b9150612f5083611f7b565b9250612f7d7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8484612e6a565b905092915050565b7f5245454e5452414e545f43414c4c0000000000000000000000000000000000005f82015250565b5f612fb9600e83612597565b9150612fc482612f85565b602082019050919050565b5f6020820190508181035f830152612fe681612fad565b9050919050565b7f494e53554646494349454e545f43414c4c45525f42414c414e434500000000005f82015250565b5f613021601b83612597565b915061302c82612fed565b602082019050919050565b5f6020820190508181035f83015261304e81613015565b9050919050565b5f6060820190506130685f8301866126df565b61307560208301856126df565b6130826040830184612423565b949350505050565b5f8115159050919050565b61309e8161308a565b81146130a8575f80fd5b50565b5f815190506130b981613095565b92915050565b5f602082840312156130d4576130d3611e8d565b5b5f6130e1848285016130ab565b91505092915050565b5f6040820190506130fd5f8301856126df565b61310a6020830184612a56565b9392505050565b5f6040820190506131245f8301856126df565b6131316020830184612423565b9392505050565b7f55494e545f554e444552000000000000000000000000000000000000000000005f82015250565b5f61316c600a83612597565b915061317782613138565b602082019050919050565b5f6020820190508181035f83015261319981613160565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601260045260245ffd5b7f4d6174683a206d756c446976206f766572666c6f7700000000000000000000005f82015250565b5f613201601583612597565b915061320c826131cd565b602082019050919050565b5f6020820190508181035f83015261322e816131f5565b905091905056fea26469706673582212204d44eee5a7abe798c8128077f06fec1fdd5a600b9e9aa0d3bed46c9f1faccc5c64736f6c634300081a0033" }))).unwrap())?.contractAddress!;
        let assetStruct = "(address,address,address,address)";
        let quoteResultStruct = "(uint256,uint256,uint256,uint256)";
        let balanceQueryResultStruct = "(uint256,uint256,uint256,uint256,uint256,uint256,uint256,uint256,uint256,uint256,uint256)";
        let swapRequestStruct = "(address,address,address,address,uint256,uint256)";
        let pairStruct = "(address,address,address,address,address,uint8,uint8,uint112,uint112)";
        let adaptorAbi = [
            `function getPair(${assetStruct}) external view returns (${pairStruct})`,
            `function getQuote(${pairStruct},uint256) external pure returns (${quoteResultStruct})`,
            `function getBalanceSheet(${pairStruct},uint256,uint256) external view returns (${balanceQueryResultStruct})`
        ];
        let pair = (await machine.query({
            to: adaptor,
            methodSignature: adaptorAbi[0],
            methodName: "getPair",
            methodArgs: [[factory, router, weth, wbtc]]
        })).unwrap() as any[];
        let quoteResult = (await machine.query({
            to: adaptor,
            methodSignature: adaptorAbi[1],
            methodName: "getQuote",
            methodArgs: [[...pair], BigInt(1 * 10**18)]
        })).unwrap() as any[];
        log(format(quoteResult[1]));
        log(format(quoteResult[2]));
        log(format(quoteResult[3]));
        let balanceQueryResult = (await machine.query({
            to: adaptor,
            methodSignature: adaptorAbi[2],
            methodName: "getBalanceSheet",
            methodArgs: [[...pair], BigInt(50 * 10**18), BigInt(8000 * 10**18)]
        })).unwrap() as any;
        balanceQueryResult.forEach(value => {
            log(format(value));
        });
        (await machine.invoke({
            to: weth,
            methodSignature: "function approve(address,uint256) external",
            methodName: "approve",
            methodArgs: [adaptor, BigInt(1 * 10**18)]
        })).unwrap();
        (await machine.invoke({
            to: adaptor,
            methodSignature: `function swap(${swapRequestStruct}) external`,
            methodName: "swap",
            methodArgs: [[factory, router, weth, wbtc, BigInt(1 * 10**18), BigInt(0.60 * 10**18)]]
        })).unwrap();
    })();
})();

function log(...any: any[]) {
    return console.log(...any);
}

function err(...any: any[]) {
    return console.error(...any);
}

function format(any: any) {
    return Number(any) / 10**18
}